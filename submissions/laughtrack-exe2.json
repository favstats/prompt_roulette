{
  "title": "LaughTrack.exe",
  "author": "favstats",
  "theme": "You're a robot learning to be human by watching sitcoms",
  "genre": "Pong Variant",
  "twist": "Lives are currency",
  "difficulty": "normal",
  "description": "A retro CRT pong-duel where you’re a robot trying to “learn humor” by blasting the ball past the TV Network. Build HUMANITY to 100% to win, but every mistake drains BATTERY—which also funds desperate upgrades (big paddle, slow time, multiball). Fast, noisy, and beatable in 2–5 minutes.",
  "submitted": "2025-12-14",
  "html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n  <title>SITCOM SIMULATOR (OFFLINE) v1.1</title>\n  <style>\n    :root{\n      --bg:#050505;\n      --neon:#32ff32;\n      --dark:#146414;\n      --alert:#ff3232;\n      --panel:rgba(0,0,0,.65);\n      --line:rgba(50,255,50,.18);\n    }\n    *{box-sizing:border-box}\n    body{\n      margin:0;\n      background:var(--bg);\n      overflow:hidden;\n      height:100vh;\n      display:grid;\n      place-items:center;\n      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace;\n      color:var(--neon);\n    }\n\n    /* CRT overlay */\n    #crt-overlay{\n      position:fixed; inset:0;\n      pointer-events:none;\n      z-index:10;\n      background:\n        linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.25) 50%),\n        linear-gradient(90deg, rgba(255,0,0,0.06), rgba(0,255,0,0.02), rgba(0,0,255,0.06));\n      background-size: 100% 2px, 3px 100%;\n      mix-blend-mode: screen;\n      opacity:.9;\n      filter: saturate(1.05);\n    }\n    #vignette{\n      position:fixed; inset:0;\n      pointer-events:none;\n      z-index:9;\n      background: radial-gradient(circle at center, rgba(0,0,0,0) 0%, rgba(0,0,0,.55) 70%, rgba(0,0,0,.85) 100%);\n    }\n\n    .wrap{\n      position:relative;\n      width:min(92vw, 860px);\n      aspect-ratio: 4 / 3;\n      display:grid;\n      place-items:center;\n    }\n\n    canvas{\n      width:100%;\n      height:100%;\n      border:2px solid #333;\n      box-shadow: 0 0 60px rgba(50,255,50,.18);\n      image-rendering: pixelated;\n      background: rgb(10,25,10);\n    }\n\n    /* HUD + controls */\n    .hud{\n      position:absolute;\n      inset: 10px 10px auto 10px;\n      display:flex;\n      gap:10px;\n      align-items:flex-start;\n      justify-content:space-between;\n      pointer-events:none;\n      z-index:4;\n    }\n    .hud .left, .hud .right{\n      display:flex;\n      flex-direction:column;\n      gap:6px;\n      pointer-events:none;\n    }\n    .chip{\n      pointer-events:none;\n      padding:6px 10px;\n      border:1px solid rgba(50,255,50,.25);\n      background: rgba(0,0,0,.35);\n      backdrop-filter: blur(6px);\n      border-radius:10px;\n      font-size:14px;\n      line-height:1.1;\n      letter-spacing:.2px;\n      text-shadow: 0 0 10px rgba(50,255,50,.25);\n    }\n    .chip.alert{\n      border-color: rgba(255,50,50,.35);\n      color: var(--alert);\n      text-shadow: 0 0 10px rgba(255,50,50,.25);\n    }\n    .centerbar{\n      position:absolute;\n      left:50%;\n      top:12px;\n      transform:translateX(-50%);\n      display:flex;\n      gap:8px;\n      z-index:4;\n      pointer-events:none;\n      opacity:.95;\n    }\n    .hint{\n      pointer-events:none;\n      padding:6px 10px;\n      border:1px solid rgba(20,100,20,.45);\n      background: rgba(0,0,0,.25);\n      border-radius:10px;\n      font-size:13px;\n      color: rgba(50,255,50,.75);\n    }\n\n    /* Overlay */\n    .overlay{\n      position:absolute;\n      inset:0;\n      display:none;\n      z-index:6;\n      align-items:center;\n      justify-content:center;\n      padding:16px;\n    }\n    .overlay.show{ display:flex; }\n    .panel{\n      width:min(720px, 95%);\n      background: var(--panel);\n      border:1px solid rgba(50,255,50,.25);\n      border-radius:16px;\n      padding:18px 16px;\n      box-shadow: 0 0 30px rgba(0,0,0,.5);\n    }\n    .panel h1{\n      margin:0 0 8px 0;\n      font-size:22px;\n      letter-spacing:.6px;\n    }\n    .panel p{\n      margin:10px 0;\n      color: rgba(50,255,50,.85);\n      font-size:14px;\n      line-height:1.5;\n    }\n    .grid{\n      display:grid;\n      grid-template-columns: 1fr 1fr;\n      gap:10px;\n      margin-top:12px;\n    }\n    .kbd{\n      display:inline-block;\n      padding:2px 6px;\n      border:1px solid rgba(50,255,50,.25);\n      border-bottom-color: rgba(50,255,50,.4);\n      border-radius:8px;\n      background: rgba(0,0,0,.3);\n      font-size:12px;\n      color: rgba(50,255,50,.9);\n      margin:0 3px;\n    }\n    .btnrow{\n      display:flex;\n      gap:10px;\n      justify-content:flex-end;\n      margin-top:14px;\n    }\n    button{\n      pointer-events:auto;\n      border:1px solid rgba(50,255,50,.35);\n      background: rgba(0,0,0,.35);\n      color: var(--neon);\n      border-radius:12px;\n      padding:10px 12px;\n      font: inherit;\n      font-size:14px;\n      cursor:pointer;\n      transition: transform .08s ease, background .08s ease, border-color .08s ease;\n      outline:none;\n    }\n    button:hover{ transform: translateY(-1px); background: rgba(0,0,0,.5); }\n    button:active{ transform: translateY(0px); }\n    button:focus-visible{\n      box-shadow: 0 0 0 3px rgba(50,255,50,.18);\n    }\n    .danger{\n      border-color: rgba(255,50,50,.45);\n      color: var(--alert);\n    }\n\n    /* Bottom micro HUD */\n    .bottom{\n      position:absolute;\n      left:50%;\n      bottom:12px;\n      transform:translateX(-50%);\n      display:flex;\n      gap:10px;\n      z-index:4;\n      pointer-events:none;\n      opacity:.95;\n      flex-wrap:wrap;\n      justify-content:center;\n    }\n\n    /* Tiny “glitch” animation */\n    @keyframes glitch {\n      0%{ transform:translate(0,0) }\n      20%{ transform:translate(-1px,0) }\n      40%{ transform:translate(1px,0) }\n      60%{ transform:translate(-1px,1px) }\n      80%{ transform:translate(1px,-1px) }\n      100%{ transform:translate(0,0) }\n    }\n    .glitchy{ animation: glitch .18s infinite; }\n\n    /* Accessibility helpers */\n    .sr-only{\n      position:absolute; width:1px; height:1px; padding:0; margin:-1px;\n      overflow:hidden; clip:rect(0,0,0,0); border:0;\n    }\n  </style>\n</head>\n<body>\n  <div id=\"vignette\"></div>\n  <div id=\"crt-overlay\"></div>\n\n  <div class=\"wrap\" role=\"application\" aria-label=\"Sitcom Simulator game\">\n    <canvas id=\"game\" width=\"800\" height=\"600\" tabindex=\"0\" aria-label=\"Game canvas\"></canvas>\n\n    <div class=\"hud\" aria-hidden=\"true\">\n      <div class=\"left\">\n        <div id=\"batteryChip\" class=\"chip\">BATTERY: 100%</div>\n        <div id=\"statusChip\" class=\"chip\" style=\"opacity:.85\">STATUS: READY</div>\n      </div>\n      <div class=\"right\">\n        <div id=\"humanChip\" class=\"chip\">HUMANITY: 0%</div>\n        <div id=\"soundChip\" class=\"chip\" style=\"opacity:.85\">SOUND: ON (M)</div>\n      </div>\n    </div>\n\n    <div class=\"centerbar\" aria-hidden=\"true\">\n      <div class=\"hint\">MISSION: ABSORB HUMAN HUMOR</div>\n      <div class=\"hint\">GOAL: HUMANITY 100%</div>\n    </div>\n\n    <div class=\"bottom\" aria-hidden=\"true\">\n      <div id=\"shopChip\" class=\"hint\">[1] SIZE (-15%) · [2] SLOW (-10%) · [3] MULTI (-20%)</div>\n      <div class=\"hint\">MOVE: ↑/↓ or W/S · HELP: H · RESTART: R</div>\n    </div>\n\n    <!-- How to Play -->\n    <div id=\"howOverlay\" class=\"overlay\" role=\"dialog\" aria-modal=\"true\" aria-label=\"How to play\">\n      <div class=\"panel\">\n        <h1>HOW TO PLAY</h1>\n        <p>\n          You are a robot trapped in a TV studio. Bounce the “humor signal” past the Network to gain\n          <b>HUMANITY</b>. Every time you miss, you lose <b>BATTERY</b>.\n        </p>\n        <div class=\"grid\">\n          <p>\n            <b>Move</b>: <span class=\"kbd\">↑</span><span class=\"kbd\">↓</span> or <span class=\"kbd\">W</span><span class=\"kbd\">S</span><br/>\n            <b>Restart</b>: <span class=\"kbd\">R</span><br/>\n            <b>Toggle sound</b>: <span class=\"kbd\">M</span>\n          </p>\n          <p>\n            <b>Battery is currency.</b><br/>\n            <span class=\"kbd\">1</span> Big Paddle (8s) −15%<br/>\n            <span class=\"kbd\">2</span> Slow Time (2s) −10%<br/>\n            <span class=\"kbd\">3</span> Multiball −20%\n          </p>\n        </div>\n        <p>\n          Tip: hit nearer the paddle’s edge to bend the shot.\n          The Network tracks imperfectly — exploit it.\n        </p>\n        <div class=\"btnrow\">\n          <button id=\"closeHelpBtn\">Close (H)</button>\n        </div>\n      </div>\n    </div>\n\n    <!-- Start / End Overlay -->\n    <div id=\"mainOverlay\" class=\"overlay show\" role=\"dialog\" aria-modal=\"true\" aria-label=\"Game menu\">\n      <div class=\"panel\" style=\"text-align:center;\">\n        <h1 id=\"title\" class=\"glitchy\">ROBOT LEARNS SITCOM</h1>\n        <p id=\"subtitle\">PRESS ANY KEY TO INITIALIZE</p>\n        <p style=\"opacity:.8;margin-top:12px;\">\n          <span class=\"kbd\">H</span> How to play · <span class=\"kbd\">M</span> Sound · <span class=\"kbd\">R</span> Restart\n        </p>\n        <div class=\"btnrow\" style=\"justify-content:center;\">\n          <button id=\"startBtn\">Start</button>\n          <button id=\"helpBtn\">How to play</button>\n          <button id=\"soundBtn\">Sound: On</button>\n        </div>\n      </div>\n    </div>\n\n    <span class=\"sr-only\" id=\"ariaLive\" aria-live=\"polite\"></span>\n  </div>\n\n<script>\n(() => {\n  // Canvas + context\n  const canvas = document.getElementById(\"game\");\n  const ctx = canvas.getContext(\"2d\");\n  ctx.imageSmoothingEnabled = false;\n\n  // DOM HUD\n  const batteryChip = document.getElementById(\"batteryChip\");\n  const humanChip   = document.getElementById(\"humanChip\");\n  const statusChip  = document.getElementById(\"statusChip\");\n  const soundChip   = document.getElementById(\"soundChip\");\n  const shopChip    = document.getElementById(\"shopChip\");\n  const ariaLive    = document.getElementById(\"ariaLive\");\n\n  const mainOverlay = document.getElementById(\"mainOverlay\");\n  const howOverlay  = document.getElementById(\"howOverlay\");\n  const titleEl     = document.getElementById(\"title\");\n  const subtitleEl  = document.getElementById(\"subtitle\");\n  const startBtn    = document.getElementById(\"startBtn\");\n  const helpBtn     = document.getElementById(\"helpBtn\");\n  const closeHelpBtn= document.getElementById(\"closeHelpBtn\");\n  const soundBtn    = document.getElementById(\"soundBtn\");\n\n  // --- Config ---\n  const W = canvas.width, H = canvas.height;\n  const NET_X = W / 2;\n\n  const PADDLE_W = 20;\n  const PADDLE_H = 80;\n  const PADDLE_SPEED = 460;\n\n  const BALL_SIZE = 12;\n  const BALL_SPEED_START = 420;\n  const SPEED_INC_ON_HIT = 22;\n\n  const COLOR_BG = \"rgb(10,25,10)\";\n  const C_NEON = \"rgb(50,255,50)\";\n  const C_DARK = \"rgb(20,100,20)\";\n  const C_ALERT= \"rgb(255,50,50)\";\n  const C_WHITE= \"rgb(245,245,245)\";\n\n  // --- Audio (WebAudio) ---\n  let audioCtx = null;\n  let soundOn = true;\n\n  function ensureAudio() {\n    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();\n    if (audioCtx.state === \"suspended\") audioCtx.resume();\n  }\n\n  function beep(freq=440, dur=0.06, type=\"square\", vol=0.04) {\n    if (!soundOn) return;\n    ensureAudio();\n    const t0 = audioCtx.currentTime;\n    const o = audioCtx.createOscillator();\n    const g = audioCtx.createGain();\n    o.type = type;\n    o.frequency.setValueAtTime(freq, t0);\n    g.gain.setValueAtTime(0.0001, t0);\n    g.gain.exponentialRampToValueAtTime(vol, t0 + 0.01);\n    g.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);\n    o.connect(g).connect(audioCtx.destination);\n    o.start(t0);\n    o.stop(t0 + dur + 0.02);\n  }\n\n  // --- Utilities ---\n  const clamp = (v, a, b) => Math.max(a, Math.min(b, v));\n  const rand = (a, b) => a + Math.random() * (b - a);\n  const now = () => performance.now();\n\n  function announce(msg){\n    ariaLive.textContent = msg;\n  }\n\n  // --- Game State ---\n  let state = \"menu\"; // menu | playing | win | lose\n  let lastT = now();\n  let timeScale = 1;\n\n  let battery = 100;\n  let humanity = 0;\n\n  let shakeT = 0;\n  let shakeMag = 0;\n\n  const player = {\n    x: 40, y: H/2,\n    w: PADDLE_W, h: PADDLE_H,\n    baseH: PADDLE_H,\n    bigUntil: 0\n  };\n\n  const enemy = {\n    x: W - 40, y: H/2,\n    w: PADDLE_W, h: PADDLE_H,\n    speed: 320,\n    // imperfection\n    reaction: 0,\n    aimJitter: 0\n  };\n\n  let balls = [];\n  let particles = [];\n  let floaties = [];\n  let flashes = []; // screen flashes\n\n  function makeBall(x, y, angleDeg, speed){\n    const a = angleDeg * Math.PI / 180;\n    return {\n      x, y,\n      vx: Math.cos(a) * speed,\n      vy: Math.sin(a) * speed,\n      speed,\n      alive: true\n    };\n  }\n\n  // --- Reset / Start ---\n  function resetRun() {\n    battery = 100;\n    humanity = 0;\n    timeScale = 1;\n    balls = [];\n    particles = [];\n    floaties = [];\n    flashes = [];\n    player.y = H/2;\n    player.h = player.baseH;\n    player.bigUntil = 0;\n    enemy.y = H/2;\n    enemy.h = PADDLE_H;\n    enemy.reaction = 0;\n    enemy.aimJitter = 0;\n    spawnServe(\"right\");\n    updateHUD();\n    statusChip.textContent = \"STATUS: LIVE\";\n    statusChip.classList.remove(\"alert\");\n  }\n\n  function spawnServe(dir){\n    const angle = rand(-25, 25) + (dir === \"right\" ? 0 : 180);\n    balls.push(makeBall(W/2, H/2, angle, BALL_SPEED_START));\n    beep(dir === \"right\" ? 600 : 420, 0.05, \"square\", 0.03);\n  }\n\n  // --- HUD ---\n  function updateHUD(){\n    battery = Math.round(clamp(battery, 0, 100));\n    humanity = Math.round(clamp(humanity, 0, 100));\n    batteryChip.textContent = `BATTERY: ${battery}%`;\n    humanChip.textContent   = `HUMANITY: ${humanity}%`;\n\n    batteryChip.classList.toggle(\"alert\", battery < 30);\n    soundChip.textContent = `SOUND: ${soundOn ? \"ON\" : \"OFF\"} (M)`;\n    soundBtn.textContent = `Sound: ${soundOn ? \"On\" : \"Off\"}`;\n  }\n\n  function addFlash(color=\"rgba(255,0,0,.25)\", dur=120){\n    flashes.push({color, t: dur});\n  }\n\n  function shake(mag=8, dur=180){\n    shakeMag = Math.max(shakeMag, mag);\n    shakeT = Math.max(shakeT, dur);\n  }\n\n  function addParticles(x, y, n=8){\n    for(let i=0;i<n;i++){\n      const a = rand(0, Math.PI*2);\n      const s = rand(60, 180);\n      particles.push({\n        x, y,\n        vx: Math.cos(a)*s,\n        vy: Math.sin(a)*s,\n        t: rand(180, 320),\n        size: rand(2, 4)\n      });\n    }\n  }\n\n  function addFloaty(txt, x, y, color=C_NEON){\n    floaties.push({txt, x, y, vy: -40, t: 520, color});\n  }\n\n  function setShopTemp(msg, ms=650, isAlert=false){\n    shopChip.textContent = msg;\n    shopChip.style.color = isAlert ? \"rgba(255,50,50,.95)\" : \"rgba(50,255,50,.75)\";\n    window.clearTimeout(setShopTemp._t);\n    setShopTemp._t = window.setTimeout(() => {\n      shopChip.textContent = \"[1] SIZE (-15%) · [2] SLOW (-10%) · [3] MULTI (-20%)\";\n      shopChip.style.color = \"rgba(50,255,50,.75)\";\n    }, ms);\n  }\n\n  // --- Collisions ---\n  function rectsOverlap(ax, ay, aw, ah, bx, by, bw, bh){\n    return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;\n  }\n\n  function ballRectCollision(ball, rx, ry, rw, rh){\n    const bx = ball.x - BALL_SIZE/2;\n    const by = ball.y - BALL_SIZE/2;\n    return rectsOverlap(bx, by, BALL_SIZE, BALL_SIZE, rx - rw/2, ry - rh/2, rw, rh);\n  }\n\n  // --- Battery/Humanity updates ---\n  function modBattery(delta){\n    battery += delta;\n    if (delta < 0){\n      addFlash(\"rgba(255,0,0,.22)\", 110);\n      shake(10, 180);\n      beep(160, 0.08, \"sawtooth\", 0.03);\n    } else {\n      beep(520, 0.05, \"square\", 0.02);\n    }\n    updateHUD();\n    if (battery <= 0){\n      battery = 0;\n      lose();\n    }\n  }\n\n  function modHumanity(delta){\n    humanity += delta;\n    addFlash(\"rgba(50,255,50,.12)\", 120);\n    addFloaty(\"Ha!\", W/2 + rand(-20, 20), 80 + rand(-10, 10), \"rgba(50,255,50,.9)\");\n    beep(740, 0.05, \"square\", 0.03);\n    updateHUD();\n    if (humanity >= 100){\n      humanity = 100;\n      win();\n    }\n  }\n\n  // --- Win/Lose ---\n  function win(){\n    state = \"win\";\n    statusChip.textContent = \"STATUS: PRIME TIME\";\n    statusChip.classList.remove(\"alert\");\n    subtitleEl.textContent = \"HUMANITY ACHIEVED — PRESS R TO REBOOT\";\n    mainOverlay.classList.add(\"show\");\n    titleEl.textContent = \"HUMANITY ACHIEVED\";\n    addFlash(\"rgba(50,255,50,.35)\", 250);\n    announce(\"You won. Press R to restart.\");\n    beep(880, 0.08, \"square\", 0.04);\n    beep(660, 0.08, \"square\", 0.035);\n    beep(990, 0.12, \"square\", 0.03);\n  }\n\n  function lose(){\n    state = \"lose\";\n    statusChip.textContent = \"STATUS: FAILURE\";\n    statusChip.classList.add(\"alert\");\n    subtitleEl.textContent = \"SYSTEM FAILURE — PRESS R TO REBOOT\";\n    mainOverlay.classList.add(\"show\");\n    titleEl.textContent = \"SYSTEM FAILURE\";\n    addFlash(\"rgba(255,50,50,.28)\", 260);\n    announce(\"You lost. Press R to restart.\");\n    beep(120, 0.12, \"sawtooth\", 0.04);\n    beep(90, 0.14, \"sawtooth\", 0.03);\n  }\n\n  // --- Input ---\n  const keys = new Set();\n  window.addEventListener(\"keydown\", (e) => {\n    // Prevent scrolling with arrows/space\n    if ([\"ArrowUp\",\"ArrowDown\",\" \"].includes(e.key)) e.preventDefault();\n\n    keys.add(e.key.toLowerCase());\n\n    // Any key starts from menu (except when help is open)\n    if (state === \"menu\" && !howOverlay.classList.contains(\"show\")) {\n      startGame();\n    }\n  }, {passive:false});\n\n  window.addEventListener(\"keyup\", (e) => keys.delete(e.key.toLowerCase()));\n\n  function startGame(){\n    mainOverlay.classList.remove(\"show\");\n    howOverlay.classList.remove(\"show\");\n    state = \"playing\";\n    resetRun();\n    canvas.focus();\n    announce(\"Game started.\");\n  }\n\n  function toggleHelp(){\n    const show = !howOverlay.classList.contains(\"show\");\n    howOverlay.classList.toggle(\"show\", show);\n    if (show) {\n      announce(\"How to play opened. Press H to close.\");\n      closeHelpBtn.focus();\n    } else {\n      announce(\"How to play closed.\");\n      canvas.focus();\n    }\n  }\n\n  function toggleSound(){\n    soundOn = !soundOn;\n    updateHUD();\n    setShopTemp(soundOn ? \"SOUND ONLINE\" : \"SOUND MUTED\", 550, false);\n    if (soundOn) beep(520, 0.05, \"square\", 0.03);\n  }\n\n  // Buttons\n  startBtn.addEventListener(\"click\", startGame);\n  helpBtn.addEventListener(\"click\", toggleHelp);\n  closeHelpBtn.addEventListener(\"click\", toggleHelp);\n  soundBtn.addEventListener(\"click\", toggleSound);\n\n  // Main hotkeys\n  window.addEventListener(\"keydown\", (e) => {\n    const k = e.key.toLowerCase();\n\n    if (k === \"h\") toggleHelp();\n    if (k === \"m\") toggleSound();\n    if (k === \"r\") {\n      if (state === \"playing\") {\n        setShopTemp(\"REBOOTING…\", 450, false);\n      }\n      if (howOverlay.classList.contains(\"show\")) howOverlay.classList.remove(\"show\");\n      state = \"playing\";\n      mainOverlay.classList.remove(\"show\");\n      resetRun();\n      canvas.focus();\n      announce(\"Restarted.\");\n    }\n\n    // Shop (only in play and when help is closed)\n    if (state !== \"playing\" || howOverlay.classList.contains(\"show\")) return;\n\n    if (k === \"1\") buyBigPaddle();\n    if (k === \"2\") buySlowTime();\n    if (k === \"3\") buyMultiBall();\n  });\n\n  // --- Shop mechanics ---\n  function insufficient(){\n    setShopTemp(\"LOW BATTERY!!!\", 650, true);\n    shake(5, 140);\n    beep(210, 0.06, \"square\", 0.02);\n  }\n\n  function buyBigPaddle(){\n    if (battery < 15) return insufficient();\n    modBattery(-15);\n    player.h = 150;\n    player.bigUntil = now() + 8000;\n    setShopTemp(\"UPGRADE: BIG PADDLE ACQUIRED\", 750, false);\n    addParticles(player.x + 20, player.y, 10);\n    beep(560, 0.06, \"square\", 0.03);\n  }\n\n  function buySlowTime(){\n    if (battery < 10) return insufficient();\n    modBattery(-10);\n    timeScale = 0.5;\n    setShopTemp(\"UPGRADE: MATRIX MODE\", 650, false);\n    addFlash(\"rgba(80,255,80,.10)\", 180);\n    // restore after 2s real-time\n    const restoreAt = now() + 2000;\n    buySlowTime._restoreAt = restoreAt;\n    beep(360, 0.08, \"triangle\", 0.03);\n  }\n\n  function buyMultiBall(){\n    if (battery < 20) return insufficient();\n    modBattery(-20);\n    const ref = balls.find(b => b.alive) || {x:W/2,y:H/2};\n    const base = BALL_SPEED_START + 40;\n    balls.push(makeBall(ref.x, ref.y, -28, base));\n    balls.push(makeBall(ref.x, ref.y,  28, base));\n    setShopTemp(\"UPGRADE: CANNED LAUGHTER\", 700, false);\n    addParticles(ref.x, ref.y, 14);\n    beep(820, 0.05, \"square\", 0.03);\n    beep(620, 0.05, \"square\", 0.03);\n  }\n\n  // --- Main update loop ---\n  function update(dt){\n    // dt in seconds, apply timeScale for gameplay\n    const t = now();\n\n    // big paddle timeout\n    if (player.bigUntil && t > player.bigUntil){\n      player.h = player.baseH;\n      player.bigUntil = 0;\n      setShopTemp(\"BIG PADDLE EXPIRED\", 550, false);\n      beep(300, 0.05, \"square\", 0.02);\n    }\n\n    // slow time restore\n    if (buySlowTime._restoreAt && t > buySlowTime._restoreAt){\n      timeScale = 1;\n      buySlowTime._restoreAt = 0;\n      setShopTemp(\"TIME NORMALIZED\", 550, false);\n      beep(520, 0.05, \"square\", 0.02);\n    }\n\n    // Player input\n    let dy = 0;\n    if (keys.has(\"arrowup\") || keys.has(\"w\")) dy -= 1;\n    if (keys.has(\"arrowdown\") || keys.has(\"s\")) dy += 1;\n    player.y += dy * PADDLE_SPEED * dt;\n    player.y = clamp(player.y, player.h/2, H - player.h/2);\n\n    // Enemy AI (imperfect)\n    enemy.reaction -= dt;\n    if (enemy.reaction <= 0){\n      enemy.reaction = rand(0.06, 0.14);\n      enemy.aimJitter = rand(-18, 18);\n    }\n\n    // choose nearest incoming ball (moving to the right)\n    const incoming = balls.filter(b => b.alive && b.vx > 0);\n    let targetY = H/2;\n    if (incoming.length){\n      incoming.sort((a,b) => b.x - a.x);\n      targetY = incoming[0].y + enemy.aimJitter;\n    }\n    const dir = Math.sign(targetY - enemy.y);\n    enemy.y += dir * enemy.speed * dt * 0.92;\n    enemy.y = clamp(enemy.y, enemy.h/2, H - enemy.h/2);\n\n    // Balls\n    for (const b of balls){\n      if (!b.alive) continue;\n\n      b.x += b.vx * dt;\n      b.y += b.vy * dt;\n\n      // wall bounce\n      if (b.y < BALL_SIZE/2){\n        b.y = BALL_SIZE/2;\n        b.vy *= -1;\n        addParticles(b.x, b.y, 6);\n        beep(520, 0.03, \"square\", 0.02);\n      } else if (b.y > H - BALL_SIZE/2){\n        b.y = H - BALL_SIZE/2;\n        b.vy *= -1;\n        addParticles(b.x, b.y, 6);\n        beep(520, 0.03, \"square\", 0.02);\n      }\n\n      // paddle collisions\n      if (ballRectCollision(b, player.x, player.y, player.w, player.h) && b.vx < 0){\n        // angle based on impact point\n        const rel = (b.y - player.y) / (player.h/2); // -1..1\n        const ang = clamp(rel, -1, 1) * 60; // degrees\n        const spd = Math.min(900, Math.hypot(b.vx, b.vy) + SPEED_INC_ON_HIT);\n        const a = ang * Math.PI / 180;\n        b.vx = Math.cos(a) * spd;\n        b.vy = Math.sin(a) * spd;\n        // ensure to the right\n        if (b.vx < 120) b.vx = 120;\n        addParticles(b.x, b.y, 10);\n        addFloaty(\"Ha!\", b.x + 8, b.y - 8, \"rgba(50,255,50,.9)\");\n        beep(740, 0.04, \"square\", 0.03);\n      }\n\n      if (ballRectCollision(b, enemy.x, enemy.y, enemy.w, enemy.h) && b.vx > 0){\n        const rel = (b.y - enemy.y) / (enemy.h/2);\n        const ang = 180 - clamp(rel, -1, 1) * 55;\n        const spd = Math.min(900, Math.hypot(b.vx, b.vy) + SPEED_INC_ON_HIT);\n        const a = ang * Math.PI / 180;\n        b.vx = Math.cos(a) * spd;\n        b.vy = Math.sin(a) * spd;\n        // ensure to the left\n        if (b.vx > -120) b.vx = -120;\n        addParticles(b.x, b.y, 10);\n        beep(520, 0.04, \"square\", 0.025);\n      }\n\n      // score logic\n      if (b.x < -BALL_SIZE){\n        b.alive = false;\n        modBattery(-15);\n      } else if (b.x > W + BALL_SIZE){\n        b.alive = false;\n        modHumanity(10);\n      }\n    }\n\n    // respawn if all dead\n    if (balls.every(b => !b.alive)) {\n      // delay serve a bit\n      if (!update._respawnAt) update._respawnAt = now() + 650;\n      if (now() > update._respawnAt){\n        update._respawnAt = 0;\n        // alternate serve direction based on last score feel\n        const dir = (Math.random() < 0.5) ? \"right\" : \"left\";\n        spawnServe(dir);\n      }\n    }\n\n    // Particles\n    for (const p of particles){\n      p.t -= dt * 1000;\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n      p.vx *= (1 - 2.2*dt);\n      p.vy *= (1 - 2.2*dt);\n    }\n    particles = particles.filter(p => p.t > 0);\n\n    // Floaty texts\n    for (const f of floaties){\n      f.t -= dt * 1000;\n      f.y += f.vy * dt;\n    }\n    floaties = floaties.filter(f => f.t > 0);\n\n    // Flashes\n    for (const fl of flashes){\n      fl.t -= dt * 1000;\n    }\n    flashes = flashes.filter(fl => fl.t > 0);\n\n    // Shake\n    if (shakeT > 0){\n      shakeT -= dt * 1000;\n      if (shakeT <= 0){ shakeT = 0; shakeMag = 0; }\n    }\n\n    // tiny title glitch in menu\n    if (state === \"menu\"){\n      titleEl.style.transform = `translate(${rand(-2,2)}px, ${rand(-1,1)}px)`;\n    } else {\n      titleEl.style.transform = \"\";\n    }\n  }\n\n  // --- Render ---\n  function render(){\n    ctx.clearRect(0,0,W,H);\n\n    // screen shake\n    let ox = 0, oy = 0;\n    if (shakeT > 0){\n      const s = shakeMag * (shakeT / 180);\n      ox = rand(-s, s);\n      oy = rand(-s, s);\n    }\n    ctx.save();\n    ctx.translate(ox, oy);\n\n    // background\n    ctx.fillStyle = COLOR_BG;\n    ctx.fillRect(0,0,W,H);\n\n    // center net\n    ctx.fillStyle = \"rgba(20,100,20,0.55)\";\n    ctx.fillRect(NET_X - 1, 0, 2, H);\n    ctx.fillStyle = \"rgba(50,255,50,0.08)\";\n    for (let y=0;y<H;y+=18){\n      ctx.fillRect(NET_X - 2, y+6, 4, 6);\n    }\n\n    // paddles\n    ctx.fillStyle = C_NEON;\n    ctx.fillRect(player.x - player.w/2, player.y - player.h/2, player.w, player.h);\n\n    ctx.fillStyle = C_ALERT;\n    ctx.fillRect(enemy.x - enemy.w/2, enemy.y - enemy.h/2, enemy.w, enemy.h);\n\n    // balls\n    for (const b of balls){\n      if (!b.alive) continue;\n      ctx.fillStyle = C_WHITE;\n      ctx.fillRect(b.x - BALL_SIZE/2, b.y - BALL_SIZE/2, BALL_SIZE, BALL_SIZE);\n      // tiny glow\n      ctx.fillStyle = \"rgba(245,245,245,0.12)\";\n      ctx.fillRect(b.x - BALL_SIZE, b.y - BALL_SIZE, BALL_SIZE*2, BALL_SIZE*2);\n    }\n\n    // particles\n    ctx.fillStyle = C_NEON;\n    for (const p of particles){\n      const a = clamp(p.t/320, 0, 1);\n      ctx.globalAlpha = a;\n      ctx.fillRect(p.x, p.y, p.size, p.size);\n    }\n    ctx.globalAlpha = 1;\n\n    // floaty texts\n    for (const f of floaties){\n      const a = clamp(f.t/520, 0, 1);\n      ctx.globalAlpha = a;\n      ctx.fillStyle = f.color;\n      ctx.font = \"14px ui-monospace, Menlo, Consolas, monospace\";\n      ctx.fillText(f.txt, f.x, f.y);\n    }\n    ctx.globalAlpha = 1;\n\n    // vignette-ish inner border\n    ctx.strokeStyle = \"rgba(50,255,50,.10)\";\n    ctx.lineWidth = 2;\n    ctx.strokeRect(6,6,W-12,H-12);\n\n    // flashes\n    for (const fl of flashes){\n      ctx.globalAlpha = clamp(fl.t/120, 0, 1);\n      ctx.fillStyle = fl.color;\n      ctx.fillRect(0,0,W,H);\n    }\n    ctx.globalAlpha = 1;\n\n    ctx.restore();\n\n    // in-game title “subtitles” (lightweight, feels like a sitcom)\n    if (state === \"playing\" && Math.random() < 0.006){\n      const zingers = [\n        \"LAUGH TRACK: ENGAGED\",\n        \"NETWORK EXECUTIVE: DISPLEASED\",\n        \"JOKE UNDERSTOOD… PROBABLY\",\n        \"PUNCHLINE DETECTED\",\n        \"SITUATION: COMEDY\",\n        \"CUT TO COMMERCIAL!\",\n        \"ROBOT: CHUCKLING (SIMULATED)\"\n      ];\n      addFloaty(zingers[(Math.random()*zingers.length)|0], 20 + rand(0, 200), 100 + rand(0, 380), \"rgba(50,255,50,.65)\");\n    }\n  }\n\n  function loopFrame(){\n    const t = now();\n    let dt = (t - lastT) / 1000;\n    lastT = t;\n    dt = Math.min(dt, 0.04); // stability\n    if (state === \"playing\" && !howOverlay.classList.contains(\"show\")){\n      update(dt * timeScale);\n      render();\n    } else {\n      // keep a soft render even in menus, so it feels alive\n      render();\n    }\n    requestAnimationFrame(loopFrame);\n  }\n\n  // --- Menu setup ---\n  function enterMenu(){\n    state = \"menu\";\n    titleEl.textContent = \"ROBOT LEARNS SITCOM\";\n    subtitleEl.textContent = \"PRESS ANY KEY TO INITIALIZE\";\n    mainOverlay.classList.add(\"show\");\n    updateHUD();\n    statusChip.textContent = \"STATUS: READY\";\n    statusChip.classList.remove(\"alert\");\n    announce(\"Menu. Press any key to start.\");\n  }\n\n  // Start in menu\n  enterMenu();\n  updateHUD();\n  requestAnimationFrame(loopFrame);\n\n  // Let canvas receive focus for keyboard play\n  canvas.addEventListener(\"pointerdown\", () => {\n    canvas.focus();\n    // unlock audio in browsers that require a gesture\n    ensureAudio();\n  });\n\n})();\n</script>\n</body>\n</html>"
}
